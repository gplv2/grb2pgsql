"use strict";function filterForJosm(){filterStrategy.setFilter(null),mergeStrategy.setFilter(null);var geodetic=new OpenLayers.Projection("EPSG:4326");newlayername="filtered-sourcelayer";var bounds=map.getExtent(),filter1=new OpenLayers.Filter.Spatial({projection:geodetic,type:OpenLayers.Filter.Spatial.BBOX,value:bounds});filterStrategy.setFilter(filter1);var overpassfilter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"source:geometry:oidn",evaluate:function(feature){var ret=!0;return $.each(overpass_layer.features,function(i,item){item.attributes.tags["source:geometry:entity"]?item.attributes.tags["source:geometry:oidn"]===feature.attributes["source:geometry:oidn"]&&item.attributes.tags["source:geometry:entity"]===feature.attributes["source:geometry:entity"]&&(ret=!1):($("#msg").html("Warning : The features from overpass are missing the entity tag, add the entity (Gbg, Knw ..) , this will improve and correct the filtering.").removeClass().addClass("notice warn"),item.attributes.tags["source:geometry:oidn"]===feature.attributes["source:geometry:oidn"]&&(ret=!1))}),ret}});mergeStrategy.setFilter(overpassfilter),$("#msg").html("<br/>Info : Filtered vector layer GRB with overpass data").removeClass().addClass("notice success")}function openInJosm(){$.ajax({url:"//localhost:8111/version",dataType:"json",timeout:5e3}).done(function(data){var version=data.protocolversion;if(version.minor<6)$("#msg").removeClass().addClass("notice error").html("Your JOSM installation does not yet support load_data requests. Please update JOSM to version 7643 or newer");else{$("#msg").removeClass().addClass("notice success").html("JOSM is ready");var geodetic=new OpenLayers.Projection("EPSG:4326"),myurl="http://localhost:8111/load_data?new_layer=true&layer_name="+newlayername+"&data=",geoJSON=new OpenLayers.Format.GeoJSON({internalProjection:map.getProjectionObject(),externalProjection:geodetic}),mylayers=map.getLayersByName("GRB - Vector Source"),json=geoJSON.write(mylayers[0].features),mylayers=null,xml=geos(JSON.parse(json)),json=null,req=new XMLHttpRequest;req.onreadystatechange=function(){4==req.readyState&&400==req.status&&testJosmVersion()},$("#msg").removeClass().addClass("notice info").html("Exporting XML to JOSM"),req.open("GET",myurl+encodeURIComponent(xml),!0),req.send(null)}}).fail(function(jqXHR,textStatus,errorThrown){$("#msg").removeClass().addClass("notice error").html("Fail to get JOSM version using remote control, is it running ?")})}function openAreaInJosm(){$.ajax({url:"//localhost:8111/version",dataType:"json",timeout:5e3}).done(function(data){function generateId(len){var arr=new Uint8Array((len||40)/2);return window.crypto.getRandomValues(arr),[].map.call(arr,function(n){return n.toString(16)}).join("")}var version=data.protocolversion;if(version.minor<6)$("#msg").removeClass().addClass("notice error").html("Your JOSM installation does not yet support load_data requests. Please update JOSM to version 7643 or newer");else{$("#msg").removeClass().addClass("notice success").html("JOSM is ready");var geodetic=new OpenLayers.Projection("EPSG:4326"),bounds=map.getExtent();bounds.transform(map.getProjectionObject(),geodetic);var myurl="http://localhost:8111/load_and_zoom?new_layer=true&layer_name="+generateId(10)+"&left="+bounds.left+"&right="+bounds.right+"&top="+bounds.top+"&bottom="+bounds.bottom;console.log(myurl);var req=new XMLHttpRequest;req.onreadystatechange=function(){4==req.readyState&&400==req.status&&testJosmVersion()},$("#msg").removeClass().addClass("notice info").html("Opening area in JOSM");var req=new XMLHttpRequest;req.open("GET",myurl,!0),req.send(null)}}).fail(function(jqXHR,textStatus,errorThrown){$("#msg").removeClass().addClass("notice error").html("Fail to get JOSM version using remote control, is it running ?")})}function testJosmVersion(){$.ajax({url:"//localhost:8111/version",dataType:"json",timeout:5e3}).done(function(data){var version=data.protocolversion;version.minor<6?$("#msg").removeClass().addClass("notice error").html("Your JOSM installation does not yet support load_data requests. Please update JOSM to version 7643 or newer"):$("#msg").removeClass().addClass("notice success").html("JOSM minor version "+version.minor)}).fail(function(jqXHR,textStatus,errorThrown){$("#msg").removeClass().addClass("notice error").html("Fail to get JOSM version using remote control, is it running ?")})}function escapeXML(str){return str.replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}function addOverpassLayer(){var geodetic=new OpenLayers.Projection("EPSG:4326");overpass_layer.destroyFeatures();var geojson_format=new OpenLayers.Format.GeoJSON({internalProjection:map.getProjectionObject(),externalProjection:geodetic});overpass_layer.addFeatures(geojson_format.read(osmInfo)),overpass_layer.setVisibility(!0),overpass_layer.refresh()}function initmap(){function onPopupClose(evt){selectCtrl.unselectAll()}function destroyPopups(event){for(;map.popups.length;)map.removePopup(map.popups[0])}function getdetails(attributes){var response="<dl>";return $.each(attributes,function(i,item){0!==strcmp("way",i)&&0!==item.length&&0!==strcmp("z_order",i)&&0!==strcmp("way_area",i)&&(response+="<dt>"+i+"</dt><dd>"+item+"</dd>")}),response+="</dl>"}function onFeatureSelect(event){if(destroyPopups(event),!$("#popupswitch").prop("checked"))return!0;var feature=event.feature;if(0!==strcmp("GRB - Vector Source",feature.layer.name))return!0;var featid="";featid=feature.attributes.building?feature.attributes.building:feature.attributes.highway?feature.attributes.highway:feature.attributes.man_made?feature.attributes.man_made:feature.attributes.oidn;var content='<div id="plopper"><fieldset><legend>'+encHTML(featid)+"</legend>"+getdetails(feature.attributes)+"</ul></fieldset></div>",popup=new OpenLayers.Popup.FramedCloud("chicken",feature.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(200,200),content,null,(!0),onPopupClose);feature.popup=popup,popup.closeOnMove=!1,map.addPopup(popup)}function onFeatureUnselect(event){var feature=event.feature;feature.popup&&(map.removePopup(feature.popup),feature.popup.destroy(),delete feature.popup)}function onloadvectorend(evt){if(isvecup=null,null==isvecup||void 0==isvecup){$("#cntain").css("width","auto"),$("#contentfilters").empty(),$("#contentfilters").css("float","right"),$("#contentfilters").append('<fieldset id="pset" style="width: 160px; display: inline-block; height: 56px;">'),$("#pset").append('<legend class="fright">Street filter</legend>'),$("#pset").append('<select id="seltagid" name="tagid" style="width:100%;">'),$("#seltagid").append(new Option("*","None"));var streets={};$.each(vector_layer.features,function(i,item){item.attributes["addr:street"]&&(streets[item.attributes["addr:street"]]=1)});var keys=[];for(var key in streets)streets.hasOwnProperty(key)&&keys.push(key);keys.sort(),$.each(keys,function(i,item){$("#seltagid").append(new Option(item,item))}),$("#contentfilters").append("</fieldset>"),$("#seltagid").change(function(){var filterstring=$("#seltagid").val(),propertysearch="addr:street";"None"==filterstring&&(filterstring="");var myfilter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:propertysearch,value:filterstring});filterstring.length<=0?streetStrategy.setFilter(null):streetStrategy.setFilter(myfilter),vector_layer.refresh();var bounds=vector_layer.getDataExtent();null!==bounds&&void 0!==bounds&&map.panTo(bounds.getCenterLonLat())}),$("#contentfilters").append('<fieldset id="bset" style="width: 160px; display: inline-block; height: 56px;">'),$("#bset").append('<legend class="fright">Building filter</legend>'),$("#bset").append('<select id="selbtype" name="tagid" style="width:100%;">'),$("#selbtype").append(new Option("*","None"));var buildings={};$.each(vector_layer.features,function(i,item){item.attributes.building&&(buildings[item.attributes.building]=item.attributes.building)});var keys=[];for(var key in buildings)buildings.hasOwnProperty(key)&&keys.push(key);keys.sort(),$.each(keys,function(i,item){$("#selbtype").append(new Option(item,item))}),$("#contentfilters").append("</fieldset>"),$("#selbtype").change(function(){var filterstring=$("#selbtype").val(),propertysearch="building";"None"==filterstring&&(filterstring="");var myfilter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:propertysearch,value:filterstring});filterstring.length<=0?buildingStrategy.setFilter(null):buildingStrategy.setFilter(myfilter),vector_layer.refresh();var bounds=vector_layer.getDataExtent();null!==bounds&&void 0!==bounds&&map.panTo(bounds.getCenterLonLat())}),isvecup=!0}}$("body").css("cursor","wait"),OpenLayers.IMAGE_RELOAD_ATTEMPTS=2;var geodetic=(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")),mercator=new OpenLayers.Projection("EPSG:900913");new OpenLayers.Projection("EPSG:31370");$(window).resize(function(){}),$("#msg").html("start init()");var layerswitcher=new OpenLayers.Control.LayerSwitcher;map=new OpenLayers.Map({div:"map",displayProjection:geodetic,theme:null,controls:[new OpenLayers.Control.Attribution,new OpenLayers.Control.Navigation({zoomWheelEnabled:!0}),new OpenLayers.Control.MousePosition,new OpenLayers.Control.LayerSwitcher,new OpenLayers.Control.ScaleLine,layerswitcher,new OpenLayers.Control.Permalink,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!1}}),new OpenLayers.Control.Zoom],units:"m",allOverlays:!1,numZoomLevels:21,layers:[new OpenLayers.Layer.OSM("OpenStreetMap",null,{numZoomLevels:20}),new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN}),new OpenLayers.Layer.Google("Google Streets",{numZoomLevels:21}),new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:21}),new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:21})]}),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(options){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(e){var geodetic=(new OpenLayers.Projection("EPSG:3857"),new OpenLayers.Projection("EPSG:4326")),lonlat=(new OpenLayers.Projection("EPSG:900913"),map.getLonLatFromPixel(e.xy));lonlat.transform(map.getProjectionObject(),geodetic),$("#msg").html("Info : "+toFixed(lonlat.lat,6)+" N, "+toFixed(lonlat.lon,6)+" E").removeClass().addClass("notice success"),lon=toFixed(lonlat.lon,6),lat=toFixed(lonlat.lat,6)}});var click=new OpenLayers.Control.Click;map.addControl(click),click.activate(),map.events.register("zoomend",this,function(event){streetStrategy.setFilter(null),buildingStrategy.setFilter(null),$("#msg").html("Scale: "+map.getScale()+" / ZoomLevel: "+map.getZoom()+" / Resolution: "+map.getResolution());var bounds=map.getExtent();bounds.transform(map.getProjectionObject(),geodetic);var center=bounds.getCenterLonLat(),setObject={lat:center.lat,lon:center.lon,zoom:map.getZoom()};localStorage.setItem("defaultlocation",JSON.stringify(setObject))}),$("body").css("cursor","default"),layerswitcher.maximizeControl();var refresh=new OpenLayers.Strategy.Refresh({force:!0,active:!0}),boxStrategy=(new OpenLayers.Strategy.Refresh({force:!0,active:!0}),new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}));filterStrategy=new OpenLayers.Strategy.Filter,mergeStrategy=new OpenLayers.Strategy.Filter,streetStrategy=new OpenLayers.Strategy.Filter,buildingStrategy=new OpenLayers.Strategy.Filter,vector_layer=new OpenLayers.Layer.Vector("GRB - Vector Source",{styleMap:vectorlayer_style,strategies:[streetStrategy,buildingStrategy,filterStrategy,mergeStrategy,boxStrategy,refresh],maxScale:420,minScale:3e3,protocol:new OpenLayers.Protocol.HTTP({url:"http://grbtiles.byteless.net/postgis_geojson.php?",format:new OpenLayers.Format.GeoJSON({extractAttributes:!0})}),projection:mercator,isBaseLayer:!1});var grb_wms=new OpenLayers.Layer.WMS("GRB Basiskaart","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB-basiskaart/wms?",{LAYERS:"GRB_BSK",transparent:"false"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!0,projection:mercator,visibility:!0});map.addLayer(grb_wms),map.setLayerIndex(grb_wms,1);var grb_wbn=new OpenLayers.Layer.WMS("GRB - WBN+ Weg/water/..","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB/wms?",{LAYERS:"GRB_WBN,GRB_WVB,GRB_SBN,GRB_WTZ,GRB_WLAS,GRB_WGR,GRB_WGO,GRB_WRL,GRB_WKN,GRB_SNM,GRB_SNM_LINKS,GRB_SNM_RECHTS",transparent:"true"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!1,projection:mercator,visibility:!1});map.addLayer(grb_wbn);var grb_gem=new OpenLayers.Layer.WMS("GRB - Gemeentegrenzen","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB/wms?",{LAYERS:"GEM_GRENS",transparent:"true"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!1,projection:mercator,visibility:!1});map.addLayer(grb_gem);var grb_knw=new OpenLayers.Layer.WMS("GRB - KNW","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB-basiskaart/wms?",{LAYERS:"GRB_KNW",transparent:"true"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!1,projection:mercator,visibility:!1});map.addLayer(grb_knw);var grb_gbg=new OpenLayers.Layer.WMS("GRB - GBG Gebouw a/d grond","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB-basiskaart/wms?",{LAYERS:"GRB_GBG",transparent:"true"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!1,projection:mercator,visibility:!1});map.addLayer(grb_gbg);var grb_gba=new OpenLayers.Layer.WMS("GRB - GBA Gebouwaanhorigheid","http://geoservices.informatievlaanderen.be/raadpleegdiensten/GRB-basiskaart/wms?",{LAYERS:"GRB_GBA",transparent:"true"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2}),refresh],tiled:!0,isBaseLayer:!1,projection:mercator,visibility:!1});map.addLayer(grb_gba);var geojson_format=new OpenLayers.Format.GeoJSON({internalProjection:map.getProjectionObject(),externalProjection:geodetic}),grb_ortho=new OpenLayers.Layer.WMS("Agiv Ortho","http://geoservices.informatievlaanderen.be/raadpleegdiensten/OMW/wms?",{WIDTH:512,HEIGHT:512,VERSION:"1.1.1",LAYERS:"OMWRGB15VL",FORMAT:"image/png"},{strategies:[new OpenLayers.Strategy.BBOX({ratio:2,resFactor:2})],tiled:!0,isBaseLayer:!0,projection:"EPSG:3857",visibility:!1});map.addLayer(grb_ortho),map.setLayerIndex(grb_ortho,1);var boxcontrol=new OpenLayers.Control;OpenLayers.Util.extend(boxcontrol,{draw:function(){this.box=new OpenLayers.Handler.Box(boxcontrol,{done:this.notice},{keyMask:OpenLayers.Handler.MOD_SHIFT}),this.box.activate()},notice:function(bounds){$("#msg").removeClass().addClass("notice info").html("Bounding box: "+bounds.toBBOX())}}),map.addControl(boxcontrol);var selectCtrl=new OpenLayers.Control.SelectFeature(vector_layer,{clickout:!0}),highlightvector=new OpenLayers.Control.SelectFeature(vector_layer,{hover:!0,highlightOnly:!0,toggle:!0,renderIntent:"temporary",eventListeners:{featurehighlighted:onFeatureSelect,featureunhighlighted:onFeatureUnselect}});map.addControl(highlightvector),map.addControl(selectCtrl),highlightvector.activate(),selectCtrl.activate(),vector_layer.events.on({featureselected:onFeatureSelect,featureunselected:onFeatureUnselect,featuresadded:function(){}}),vector_layer.events.register("loadend",this,onloadvectorend),map.addLayer(vector_layer),vector_layer.setVisibility(!0),map.addControl(highlightvector),highlightvector.activate();var retrievedObject=JSON.parse(localStorage.getItem("defaultlocation"));if(retrievedObject){var lonLat=new OpenLayers.LonLat(retrievedObject.lon,retrievedObject.lat).transform(geodetic,map.getProjectionObject());map.setCenter(lonLat,retrievedObject.zoom)}else{var lonLat=new OpenLayers.LonLat(lon,lat).transform(geodetic,map.getProjectionObject());map.setCenter(lonLat,zoom)}var overpass_styled=new OpenLayers.Style({fillColor:"red",fillOpacity:.6,fontColor:"#000000",fontWeight:"light",pointRadius:8,fontSize:"11px",strokeColor:"#ff9963",strokeWidth:3,pointerEvents:"all",labelOutlineColor:"white",labelOutlineWidth:8,labelAlign:"cm",cursor:"pointer",fontFamily:"sans-serif"}),overpass_temp_styled=new OpenLayers.Style({fillColor:"red",fontColor:"#000000",fontWeight:"normal",pointRadius:8,fontSize:"11px",strokeColor:"#ff9933",strokeWidth:2,pointerEvents:"all",fillOpacity:.3,labelOutlineColor:"white",labelAlign:"rb",labelOutlineWidth:8,cursor:"pointer",fontFamily:"sans-serif"}),overpass_style=new OpenLayers.StyleMap({"default":overpass_styled,temporary:overpass_temp_styled});overpass_style.styles["default"].addRules([new OpenLayers.Rule({maxScaleDenominator:6e7,minScaleDenominator:215e3,symbolizer:{fillColor:"red",fillOpacity:.6,fontColor:"#000000",fontWeight:"light",pointRadius:2,fontSize:"11px",strokeColor:"#ff9963",strokeWidth:1,pointerEvents:"all",labelOutlineColor:"white",labelOutlineWidth:8,labelAlign:"cm",cursor:"pointer",fontFamily:"sans-serif"}}),new OpenLayers.Rule({maxScaleDenominator:215e3,minScaleDenominator:27e3,symbolizer:{fillColor:"red",fillOpacity:.6,fontColor:"#000000",fontWeight:"light",pointRadius:4,fontSize:"11px",strokeColor:"#ff9963",strokeWidth:2,pointerEvents:"all",labelOutlineColor:"white",labelOutlineWidth:8,labelAlign:"cm",cursor:"pointer",fontFamily:"sans-serif"}}),new OpenLayers.Rule({maxScaleDenominator:27e3,minScaleDenominator:3384,symbolizer:{fillColor:"red",fillOpacity:.6,fontColor:"#000000",fontWeight:"light",pointRadius:10,fontSize:"11px",strokeColor:"#ff9963",strokeWidth:3,pointerEvents:"all",labelOutlineColor:"white",labelOutlineWidth:8,labelAlign:"cm",cursor:"pointer",fontFamily:"sans-serif"}}),new OpenLayers.Rule({maxScaleDenominator:3384,minScaleDenominator:1,symbolizer:{fillColor:"red",fillOpacity:.6,fontColor:"#000000",fontWeight:"light",pointRadius:10,fontSize:"11px",strokeColor:"#ff9963",strokeWidth:3,labelAlign:"cm",pointerEvents:"all",labelOutlineColor:"white",labelOutlineWidth:8,cursor:"pointer",fontFamily:"sans-serif"}})]);var geojson_format=new OpenLayers.Format.GeoJSON({internalProjection:map.getProjectionObject(),externalProjection:geodetic});overpass_layer=new OpenLayers.Layer.Vector("Overpass - GRB Data in OSM",{styleMap:overpass_style,format:geojson_format,isBaseLayer:!1,visibility:!1,extractStyles:!1,extractAttributes:!0}),map.addLayer(overpass_layer),map.setLayerIndex(overpass_layer,0)}function getOsmInfo(){var geodetic=new OpenLayers.Projection("EPSG:4326");$("#msg").removeClass().addClass("notice info");var bounds=map.getExtent();bounds.transform(map.getProjectionObject(),geodetic);var query='<osm-script output="json" timeout="250">  <union>    <query type="way">      <has-kv k="source:geometry:oidn"/>      <bbox-query e="'+bounds.right+'" n="'+bounds.top+'" s="'+bounds.bottom+'" w="'+bounds.left+'"/>    </query>    <query type="relation">      <has-kv k="source:geometry:oidn" />      <bbox-query e="'+bounds.right+'" n="'+bounds.top+'" s="'+bounds.bottom+'" w="'+bounds.left+'"/>    </query>  </union>  <union>    <item/>    <recurse type="down"/>  </union>  <print mode="meta"/></osm-script>',req=new XMLHttpRequest,overpasserror="";req.onreadystatechange=function(){switch(req.readyState){case 0:overpasserror="Overpass request not initialized";break;case 1:overpasserror="Overpass server connection established";break;case 2:overpasserror="Overpass request received";break;case 3:overpasserror="Overpass processing request";break;case 4:overpasserror="Overpass request finished and response is ready";break;default:overpasserror="Overpass Unknown status"}if($("#msg").html("Info : "+overpasserror).removeClass().addClass("notice info"),4==req.readyState){if(200!=req.status)return overpasserror='non "HTTP 200 OK" status: '+req.status,void $("#msg").switchClass("info","error",200,"easeInOutQuad").html("Error : "+overpasserror).switchClass("info","error",1e3,"easeInOutQuad");var data="";try{$("#msg").html("Info : Parsing JSON").removeClass().addClass("notice info"),data=JSON.parse(req.responseText)}catch(e){return $("#msg").removeClass().addClass("notice error").html("Problem parsing Overpass JSON data"+e),!1}$("#msg").html("Info : Parsing OK").removeClass().addClass("notice success"),osmInfo=osmtogeojson(data),addOverpassLayer()}},req.open("GET",overpassapi+encodeURIComponent(query),!0),req.send(null)}function isEncHTML(str){return str.search(/&amp;/g)!=-1||str.search(/&lt;/g)!=-1||str.search(/&gt;/g)!=-1}function decHTMLifEnc(str){return isEncHTML(str)?str.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"):str}function encHTML(str){return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function strcmp(str1,str2){return str1==str2?0:str1>str2?1:-1}function toFixed(value,precision){var power=Math.pow(10,precision||0);return String(Math.round(value*power)/power)}var tcontext={getColor:function(feature){return"EVENTS"==feature.attributes.category?"red":"WORKS"==feature.attributes.category?"orange":"green"}},event_styled=new OpenLayers.Style({fillColor:"${getColor}",pointRadius:2,fontWeight:"normal",strokeColor:"red",strokeWidth:"2",pointerEvents:"all",fillOpacity:.8,cursor:"pointer",label:"${cause}",labelOutlineColor:"white",labelOutlineWidth:3,fontFamily:"sans-serif"},{context:tcontext}),event_temp_styled=new OpenLayers.Style({fillColor:"white",strokeColor:"#ff9933",strokeWidth:4,pointerEvents:"all",fillOpacity:.4,cursor:"pointer",label:"${cause}",labelOutlineColor:"white",labelOutlineWidth:4,fontFamily:"sans-serif"},{context:tcontext}),eventlayer_style=new OpenLayers.StyleMap({"default":event_styled,temporary:event_temp_styled});eventlayer_style.styles["default"].addRules([new OpenLayers.Rule({maxScaleDenominator:6e7,minScaleDenominator:433344,symbolizer:{Point:{pointRadius:5,graphicName:"square",fillColor:"white",fillOpacity:.25,strokeWidth:1,strokeOpacity:1,strokeColor:"#3333aa"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:1,strokeOpacity:1,fillColor:"#9999aa",strokeColor:"#6666aa"}}}),new OpenLayers.Rule({maxScaleDenominator:433344,minScaleDenominator:54168,symbolizer:{Point:{pointRadius:5,graphicName:"square",fillColor:"white",fillOpacity:.25,strokeWidth:1,strokeOpacity:1,strokeColor:"#3333aa"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:1,strokeOpacity:1,fillColor:"#9999aa",strokeColor:"#6666aa"}}}),new OpenLayers.Rule({maxScaleDenominator:54168,minScaleDenominator:1,symbolizer:{Point:{pointRadius:5,graphicName:"square",fillColor:"white",fillOpacity:.25,strokeWidth:1,strokeOpacity:1,strokeColor:"#3333aa"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ff0000"},Polygon:{strokeWidth:1,strokeOpacity:1,fillColor:"#9999aa",strokeColor:"#6666aa"}}})]);var context={getColor:function(feature){return"house"==feature.attributes.building?"red":"shed"==feature.attributes.building?"orange":"roof"==feature.attributes.building?"brown":"steps"==feature.attributes.highway?"yellow":feature.attributes.man_made?"green":"purple"},getLabel:function(feature){return $("#labelswitch").prop("checked")?feature.attributes.building?feature.attributes.building:feature.attributes.highway?feature.attributes.highway:feature.attributes.man_made?feature.attributes.man_made:"?":""},getAddress:function(feature){var addr="";return feature.attributes["addr:street"]&&(addr=feature.attributes["addr:street"]),feature.attributes["addr:housenumber"]&&(addr+=" / "+feature.attributes["addr:housenumber"]),addr},getAdd:function(feature){var addr=0;return feature.attributes["addr:street"]&&addr++,feature.attributes["addr:housenumber"]&&addr++,feature.attributes["addr:flats"]&&addr++,addr}},asset_styled=new OpenLayers.Style({fillColor:"${getColor}",strokeColor:"black",strokeWidth:"${getAdd}",pointerEvents:"all",fillOpacity:.6,cursor:"pointer",label:"${getLabel}",labelOutlineColor:"white",labelOutlineWidth:3,fontFamily:"sans-serif"},{context:context}),asset_temp_styled=new OpenLayers.Style({fillColor:"white",strokeColor:"#ff9933",strokeWidth:4,pointerEvents:"all",fillOpacity:.4,cursor:"pointer",label:"${getAddress}",labelOutlineColor:"white",labelOutlineWidth:4,fontFamily:"sans-serif"},{context:context}),vectorlayer_style=new OpenLayers.StyleMap({"default":asset_styled,temporary:asset_temp_styled});vectorlayer_style.styles["default"].addRules([new OpenLayers.Rule({maxScaleDenominator:6e7,minScaleDenominator:433344,symbolizer:{fontColor:"#333333",fontWeight:"bolder",pointRadius:8,fontSize:"8px"}}),new OpenLayers.Rule({maxScaleDenominator:433344,minScaleDenominator:54168,symbolizer:{fontColor:"#333333",fontWeight:"bolder",pointRadius:14,fontSize:"11px"}}),new OpenLayers.Rule({maxScaleDenominator:54168,minScaleDenominator:1,symbolizer:{fontColor:"#333333",fontWeight:"bolder",pointRadius:20,fontSize:"20px"}})]),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.osmtogeojson=e()}}(function(){return function e(n,t,r){function o(i,s){if(!t[i]){if(!n[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[i]={exports:{}};n[i][0].call(c.exports,function(e){var t=n[i][1][e];return o(t?t:e)},c,c.exports,e,n,t,r)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n,t){var r=e("./lodash.custom.js"),o=e("geojson-rewind"),a=e("./polygon_features.json"),i={};i=function(e,n){function t(e){function n(e){var n=r.clone(e);n.lat=e.center.lat,n.lon=e.center.lon,n.__is_center_placeholder=!0,i.push(n)}function t(e){function n(e,n,r){var o={type:"node",id:"_"+t.type+"/"+t.id+"bounds"+r,lat:e,lon:n};t.nodes.push(o.id),i.push(o)}var t=r.clone(e);t.nodes=[],n(t.bounds.minlat,t.bounds.minlon,1),n(t.bounds.maxlat,t.bounds.minlon,2),n(t.bounds.maxlat,t.bounds.maxlon,3),n(t.bounds.minlat,t.bounds.maxlon,4),t.nodes.push(t.nodes[0]),t.__is_bounds_placeholder=!0,u.push(t)}function o(e){function n(e,n,t){var r={type:"node",id:t,lat:e,lon:n,__is_uninteresting:!0};i.push(r)}r.isArray(e.nodes)||(e.nodes=e.geometry.map(function(e){return null!==e?"_anonymous@"+e.lat+"/"+e.lon:"_anonymous@unknown_location"})),e.geometry.forEach(function(t,r){t&&n(t.lat,t.lon,e.nodes[r])})}function a(e){function n(e,n,t){var r={type:"node",id:t,lat:e,lon:n};i.push(r)}function t(e,n){function t(e,n){var t={type:"node",id:"_anonymous@"+e+"/"+n,lat:e,lon:n,__is_uninteresting:!0};r.nodes.push(t.id),i.push(t)}if(!u.some(function(e){return"way"==e.type&&e.id==n})){var r={type:"way",id:n,nodes:[]};e.forEach(function(e){e?t(e.lat,e.lon):r.nodes.push(void 0)}),u.push(r)}}e.members.forEach(function(e,r){"node"==e.type?e.lat&&n(e.lat,e.lon,e.ref):"way"==e.type&&e.geometry&&(e.ref="_fullGeom"+e.ref,t(e.geometry,e.ref))})}for(var i=new Array,u=new Array,l=new Array,c=0;c<e.elements.length;c++)switch(e.elements[c].type){case"node":var f=e.elements[c];i.push(f);break;case"way":var p=r.clone(e.elements[c]);p.nodes=r.clone(p.nodes),u.push(p),p.center&&n(p),p.geometry?o(p):p.bounds&&t(p);break;case"relation":var d=r.clone(e.elements[c]);d.members=r.clone(d.members),l.push(d);var g=d.members&&d.members.some(function(e){return"node"==e.type&&e.lat||"way"==e.type&&e.geometry&&e.geometry.length>0});d.center&&n(d),g?a(d):d.bounds&&t(d)}return s(i,u,l)}function i(e){function n(e,n,t){e.hasAttribute(t)&&(n[t]=e.getAttribute(t))}function t(e,t){var o=r.clone(e);n(t,o,"lat"),n(t,o,"lon"),o.__is_center_placeholder=!0,u.push(o)}function o(e,n){function t(e,n,t){var r={type:"node",id:"_"+o.type+"/"+o.id+"bounds"+t,lat:e,lon:n};o.nodes.push(r.id),u.push(r)}var o=r.clone(e);o.nodes=[],t(n.getAttribute("minlat"),n.getAttribute("minlon"),1),t(n.getAttribute("maxlat"),n.getAttribute("minlon"),2),t(n.getAttribute("maxlat"),n.getAttribute("maxlon"),3),t(n.getAttribute("minlat"),n.getAttribute("maxlon"),4),o.nodes.push(o.nodes[0]),o.__is_bounds_placeholder=!0,l.push(o)}function a(e,n){function t(e,n,t){var r={type:"node",id:t,lat:e,lon:n,__is_uninteresting:!0};return u.push(r),r.id}r.isArray(e.nodes)||(e.nodes=[],r.each(n,function(n,t){e.nodes.push("_anonymous@"+n.getAttribute("lat")+"/"+n.getAttribute("lon"))})),r.each(n,function(n,r){n.getAttribute("lat")&&t(n.getAttribute("lat"),n.getAttribute("lon"),e.nodes[r])})}function i(e,n){function t(e,n,t){var r={type:"node",id:t,lat:e,lon:n};u.push(r)}function o(e,n){function t(e,n){var t={type:"node",id:"_anonymous@"+e+"/"+n,lat:e,lon:n,__is_uninteresting:!0};o.nodes.push(t.id),u.push(t)}if(!l.some(function(e){return"way"==e.type&&e.id==n})){var o={type:"way",id:n,nodes:[]};r.each(e,function(e){e.getAttribute("lat")?t(e.getAttribute("lat"),e.getAttribute("lon")):o.nodes.push(void 0)}),l.push(o)}}r.each(n,function(n,r){"node"==e.members[r].type?n.getAttribute("lat")&&t(n.getAttribute("lat"),n.getAttribute("lon"),e.members[r].ref):"way"==e.members[r].type&&n.getElementsByTagName("nd").length>0&&(e.members[r].ref="_fullGeom"+e.members[r].ref,o(n.getElementsByTagName("nd"),e.members[r].ref))})}var u=new Array,l=new Array,c=new Array;r.each(e.getElementsByTagName("node"),function(e,t){var o={};r.each(e.getElementsByTagName("tag"),function(e){o[e.getAttribute("k")]=e.getAttribute("v")});var a={type:"node"};n(e,a,"id"),n(e,a,"lat"),n(e,a,"lon"),n(e,a,"version"),n(e,a,"timestamp"),n(e,a,"changeset"),n(e,a,"uid"),n(e,a,"user"),r.isEmpty(o)||(a.tags=o),u.push(a)});var f,p;return r.each(e.getElementsByTagName("way"),function(e,i){var s={},u=[];r.each(e.getElementsByTagName("tag"),function(e){s[e.getAttribute("k")]=e.getAttribute("v")});var c=!1;r.each(e.getElementsByTagName("nd"),function(e,n){var t;(t=e.getAttribute("ref"))&&(u[n]=t),!c&&e.getAttribute("lat")&&(c=!0)});var d={type:"way"};n(e,d,"id"),n(e,d,"version"),n(e,d,"timestamp"),n(e,d,"changeset"),n(e,d,"uid"),n(e,d,"user"),u.length>0&&(d.nodes=u),r.isEmpty(s)||(d.tags=s),(f=e.getElementsByTagName("center")[0])&&t(d,f),c?a(d,e.getElementsByTagName("nd")):(p=e.getElementsByTagName("bounds")[0])&&o(d,p),l.push(d)}),r.each(e.getElementsByTagName("relation"),function(e,a){var s={},u=[];r.each(e.getElementsByTagName("tag"),function(e){s[e.getAttribute("k")]=e.getAttribute("v")});var l=!1;r.each(e.getElementsByTagName("member"),function(e,t){u[t]={},n(e,u[t],"ref"),n(e,u[t],"role"),n(e,u[t],"type"),(!l&&"node"==u[t].type&&e.getAttribute("lat")||"way"==u[t].type&&e.getElementsByTagName("nd").length>0)&&(l=!0)});var d={type:"relation"};n(e,d,"id"),n(e,d,"version"),n(e,d,"timestamp"),n(e,d,"changeset"),n(e,d,"uid"),n(e,d,"user"),u.length>0&&(d.members=u),r.isEmpty(s)||(d.tags=s),(f=e.getElementsByTagName("center")[0])&&t(d,f),l?i(d,e.getElementsByTagName("member")):(p=e.getElementsByTagName("bounds")[0])&&o(d,p),c.push(d)}),s(u,l,c)}function s(e,t,a){function i(e,t){if("object"!=typeof t&&(t={}),"function"==typeof n.uninterestingTags)return!n.uninterestingTags(e,t);for(var r in e)if(n.uninterestingTags[r]!==!0&&t[r]!==!0&&t[r]!==e[r])return!0;return!1}function s(e){var n={timestamp:e.timestamp,version:e.version,changeset:e.changeset,user:e.user,uid:e.uid};for(k in n)void 0===n[k]&&delete n[k];return n}function l(e,t){function o(e){for(var t,r,o,a,i,s,u=function(e){return e[0]},f=function(e){return e[e.length-1]},p=[];e.length;)for(t=e.pop().nodes.slice(),p.push(t);e.length&&u(t)!==f(t);){for(r=u(t),o=f(t),a=0;a<e.length;a++){if(s=e[a].nodes,o===u(s)){i=t.push,s=s.slice(1);break}if(o===f(s)){i=t.push,
s=s.slice(0,-1).reverse();break}if(r==f(s)){i=t.unshift,s=s.slice(0,-1);break}if(r==u(s)){i=t.unshift,s=s.slice(1).reverse();break}s=i=null}if(!s){n.verbose&&console.warn("Multipolygon",l+"/"+c,"contains unclosed ring geometry");break}e.splice(a,1),i.apply(t,s)}return p}function a(e){var n,t,r=function(e,n){for(var t=0;t<n.length;t++)if(a(n[t],e))return!0;return!1},o=function(e){return e.map(function(e){return[+e.lat,+e.lon]})},a=function(e,n){for(var t=e[0],r=e[1],o=!1,a=0,i=n.length-1;a<n.length;i=a++){var s=n[a][0],u=n[a][1],l=n[i][0],c=n[i][1],f=u>r!=c>r&&(l-s)*(r-u)/(c-u)+s>t;f&&(o=!o)}return o};for(e=o(e),n=0;n<f.length;n++)if(t=o(f[n]),r(t,e))return n}var i,u=!1,l=T?"way":"relation",c="number"==typeof e.id?e.id:+e.id.replace("_fullGeom","");i=t.members.filter(function(e){return"way"===e.type}),i=i.map(function(e){var t=g[e.ref];return void 0===t?(n.verbose&&console.warn("Multipolygon",l+"/"+c,"tainted by a missing way",e.type+"/"+e.ref),void(u=!0)):{id:e.ref,role:e.role||"outer",way:t,nodes:t.nodes.filter(function(t){return void 0!==t||(u=!0,n.verbose&&console.warn("Multipolygon",l+"/"+c,"tainted by a way",e.type+"/"+e.ref,"with a missing node"),!1)})}}),i=r.compact(i);var f,p;f=o(i.filter(function(e){return"outer"===e.role})),p=o(i.filter(function(e){return"inner"===e.role}));var d;d=f.map(function(e){return[e]});for(var y=0;y<p.length;y++){var m=a(p[y]);void 0!==m?d[m].push(p[y]):n.verbose&&console.warn("Multipolygon",l+"/"+c,"contains an inner ring with no containing outer")}var b=[];if(b=r.compact(d.map(function(e){var t=r.compact(e.map(function(e){return e.length<4?void(n.verbose&&console.warn("Multipolygon",l+"/"+c,"contains a ring with less than four nodes")):r.compact(e.map(function(e){return[+e.lon,+e.lat]}))}));return 0==t.length?void(n.verbose&&console.warn("Multipolygon",l+"/"+c,"contains an empty ring cluster")):t})),0==b.length)return n.verbose&&console.warn("Multipolygon",l+"/"+c,"contains no coordinates"),!1;var v="MultiPolygon";1===b.length&&(v="Polygon",b=b[0]);var w={type:"Feature",id:e.type+"/"+c,properties:{type:e.type,id:c,tags:e.tags||{},relations:h[e.type][e.id]||[],meta:s(e)},geometry:{type:v,coordinates:b}};return u&&(n.verbose&&console.warn("Multipolygon",l+"/"+c,"is tainted"),w.properties.tainted=!0),w}for(var c=new Object,f=0;f<e.length;f++)void 0!==e[f].lat?c[e[f].id]=e[f]:n.verbose&&console.warn("Node",e[f].type+"/"+e[f].id,"ignored because it has no coordinates");for(var p=new Object,f=0;f<e.length;f++)"undefined"!=typeof e[f].tags&&i(e[f].tags)&&(p[e[f].id]=!0);for(var f=0;f<a.length;f++)if(r.isArray(a[f].members))for(var d=0;d<a[f].members.length;d++)"node"==a[f].members[d].type&&(p[a[f].members[d].ref]=!0);else n.verbose&&console.warn("Relation",a[f].type+"/"+a[f].id,"ignored because it has no members");for(var g=new Object,y=new Object,f=0;f<t.length;f++)if(r.isArray(t[f].nodes)){g[t[f].id]=t[f];for(var d=0;d<t[f].nodes.length;d++)y[t[f].nodes[d]]=!0,t[f].nodes[d]=c[t[f].nodes[d]]}else n.verbose&&console.warn("Way",t[f].type+"/"+t[f].id,"ignored because it has no nodes");for(var m=new Array,f=0;f<e.length;f++)y[e[f].id]&&!p[e[f].id]||e[f].__is_uninteresting||m.push(e[f]);for(var b=new Array,f=0;f<a.length;f++)r.isArray(a[f].members)?b[a[f].id]=a[f]:n.verbose&&console.warn("Relation",a[f].type+"/"+a[f].id,"ignored because it has no members");for(var h={node:{},way:{},relation:{}},f=0;f<a.length;f++)if(r.isArray(a[f].members))for(var d=0;d<a[f].members.length;d++){var v;switch(a[f].members[d].type){case"node":v=c[a[f].members[d].ref];break;case"way":v=g[a[f].members[d].ref];break;case"relation":v=b[a[f].members[d].ref]}if(v){var w=a[f].members[d].type,_=a[f].members[d].ref;"undefined"==typeof h[w][_]&&(h[w][_]=[]),h[w][_].push({role:a[f].members[d].role,rel:a[f].id,reltags:a[f].tags})}else n.verbose&&console.warn("Relation",a[f].type+"/"+a[f].id,"member",a[f].members[d].type+"/"+a[f].members[d].id,"ignored because it has an invalid type")}else n.verbose&&console.warn("Relation",a[f].type+"/"+a[f].id,"ignored because it has no members");var x,A={type:"FeatureCollection",features:new Array};for(f=0;f<m.length;f++)if("undefined"!=typeof m[f].lon&&"undefined"!=typeof m[f].lat){var j={type:"Feature",id:m[f].type+"/"+m[f].id,properties:{type:m[f].type,id:m[f].id,tags:m[f].tags||{},relations:h.node[m[f].id]||[],meta:s(m[f])},geometry:{type:"Point",coordinates:[+m[f].lon,+m[f].lat]}};m[f].__is_center_placeholder&&(j.properties.geometry="center"),A.features.push(j)}else n.verbose&&console.warn("POI",m[f].type+"/"+m[f].id,"ignored because it lacks coordinates");for(var E={type:"FeatureCollection",features:new Array},P={type:"FeatureCollection",features:new Array},f=0;f<a.length;f++)if("undefined"!=typeof a[f].tags&&("multipolygon"==a[f].tags.type||"boundary"==a[f].tags.type)){if(!r.isArray(a[f].members)){n.verbose&&console.warn("Multipolygon",a[f].type+"/"+a[f].id,"ignored because it has no members");continue}for(var O=0,d=0;d<a[f].members.length;d++)"outer"==a[f].members[d].role?O++:n.verbose&&"inner"!=a[f].members[d].role&&console.warn("Multipolygon",a[f].type+"/"+a[f].id,"member",a[f].members[d].type+"/"+a[f].members[d].ref,'ignored because it has an invalid role: "'+a[f].members[d].role+'"');if(a[f].members.forEach(function(e){g[e.ref]&&("outer"!==e.role||i(g[e.ref].tags,a[f].tags)||(g[e.ref].is_multipolygon_outline=!0),"inner"!==e.role||i(g[e.ref].tags)||(g[e.ref].is_multipolygon_outline=!0))}),0==O){n.verbose&&console.warn("Multipolygon relation",a[f].type+"/"+a[f].id,"ignored because it has no outer ways");continue}var T=!1;1!=O||i(a[f].tags,{type:!0})||(T=!0);var j=null;if(T){var N=a[f].members.filter(function(e){return"outer"===e.role})[0];if(N=g[N.ref],void 0===N){n.verbose&&console.warn("Multipolygon relation",a[f].type+"/"+a[f].id,"ignored because outer way",N.type+"/"+N.ref,"is missing");continue}N.is_multipolygon_outline=!0,j=l(N,a[f])}else j=l(a[f],a[f]);if(j===!1){n.verbose&&console.warn("Multipolygon relation",a[f].type+"/"+a[f].id,"ignored because it has invalid geometry");continue}P.features.push(j)}for(var f=0;f<t.length;f++)if(r.isArray(t[f].nodes)){if(!t[f].is_multipolygon_outline){for(t[f].tainted=!1,t[f].hidden=!1,coords=new Array,d=0;d<t[f].nodes.length;d++)"object"==typeof t[f].nodes[d]?coords.push([+t[f].nodes[d].lon,+t[f].nodes[d].lat]):(n.verbose&&console.warn("Way",t[f].type+"/"+t[f].id,"is tainted by an invalid node"),t[f].tainted=!0);if(coords.length<=1)n.verbose&&console.warn("Way",t[f].type+"/"+t[f].id,"ignored because it contains too few nodes");else{var S="LineString";"undefined"!=typeof t[f].nodes[0]&&t[f].nodes[0]===t[f].nodes[t[f].nodes.length-1]&&("undefined"!=typeof t[f].tags&&u(t[f].tags)||t[f].__is_bounds_placeholder)&&(S="Polygon",coords=[coords]);var j={type:"Feature",id:t[f].type+"/"+t[f].id,properties:{type:t[f].type,id:t[f].id,tags:t[f].tags||{},relations:h.way[t[f].id]||[],meta:s(t[f])},geometry:{type:S,coordinates:coords}};t[f].tainted&&(n.verbose&&console.warn("Way",t[f].type+"/"+t[f].id,"is tainted"),j.properties.tainted=!0),t[f].__is_bounds_placeholder&&(j.properties.geometry="bounds"),"LineString"==S?E.features.push(j):P.features.push(j)}}}else n.verbose&&console.warn("Way",t[f].type+"/"+t[f].id,"ignored because it has no nodes");return x={type:"FeatureCollection",features:[]},x.features=x.features.concat(P.features),x.features=x.features.concat(E.features),x.features=x.features.concat(A.features),n.flatProperties&&x.features.forEach(function(e){e.properties=r.merge(e.properties.meta,e.properties.tags,{id:e.properties.type+"/"+e.properties.id})}),x=o(x,!0)}function u(e){var t=n.polygonFeatures;if("function"==typeof t)return t(e);if("no"===e.area)return!1;for(var r in e){var o=e[r],a=t[r];if("undefined"!=typeof a&&"no"!==o){if(a===!0)return!0;if(a.included_values&&a.included_values[o]===!0)return!0;if(a.excluded_values&&a.excluded_values[o]!==!0)return!0}}return!1}n=r.merge({verbose:!1,flatProperties:!1,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:a},n);var l;return l="undefined"!=typeof XMLDocument&&e instanceof XMLDocument||"undefined"==typeof XMLDocument&&e.childNodes?i(e):t(e)},i.toGeojson=i,n.exports=i},{"./lodash.custom.js":2,"./polygon_features.json":6,"geojson-rewind":3}],2:[function(e,n,t){(function(e){(function(){function r(){return S.pop()||[]}function o(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function a(e){e.length=0,S.length<M&&S.push(e)}function i(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,a=Array(0>o?0:o);++r<o;)a[r]=e[n+r];return a}function s(){}function u(e){function n(){if(r){var e=i(r);pe.apply(e,arguments)}if(this instanceof n){var a=c(t.prototype),s=t.apply(a,e||arguments);return x(s)?s:a}return t.apply(o,e||arguments)}var t=e[0],r=e[2],o=e[4];return Ae(n,e),n}function l(e,n,t,s,u){if(t){var c=t(e);if("undefined"!=typeof c)return c}var f=x(e);if(!f)return e;var p=se.call(e);if(!z[p]||!_e.nodeClass&&o(e))return e;var d=ve[p];switch(p){case H:case U:return new d((+e));case q:case V:return new d(e);case X:return c=d(e.source,L.exec(e)),c.lastIndex=e.lastIndex,c}var g=je(e);if(n){var y=!s;s||(s=r()),u||(u=r());for(var m=s.length;m--;)if(s[m]==e)return u[m];c=g?d(e.length):{}}else c=g?i(e):Se({},e);return g&&(fe.call(e,"index")&&(c.index=e.index),fe.call(e,"input")&&(c.input=e.input)),n?(s.push(e),u.push(c),(g?Ne:Me)(e,function(e,r){c[r]=l(e,n,t,s,u)}),y&&(a(s),a(u)),c):c}function c(e,n){return x(e)?me(e):{}}function f(e,n,t){if("function"!=typeof e)return T;if("undefined"==typeof n||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(_e.funcNames&&(r=!e.name),r=r||!_e.funcDecomp,!r)){var o=le.call(e);_e.funcNames||(r=!B.test(o)),r||(r=F.test(o),Ae(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(t){case 1:return function(t){return e.call(n,t)};case 2:return function(t,r){return e.call(n,t,r)};case 3:return function(t,r,o){return e.call(n,t,r,o)};case 4:return function(t,r,o,a){return e.call(n,t,r,o,a)}}return O(e,n)}function p(e){function n(){var e=l?s:this;if(o){var m=i(o);pe.apply(m,arguments)}if((a||d)&&(m||(m=i(arguments)),a&&pe.apply(m,a),d&&m.length<u))return r|=16,p([t,g?r:-4&r,m,null,s,u]);if(m||(m=arguments),f&&(t=e[y]),this instanceof n){e=c(t.prototype);var b=t.apply(e,m);return x(b)?b:e}return t.apply(e,m)}var t=e[0],r=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=1&r,f=2&r,d=4&r,g=8&r,y=t;return Ae(n,e),n}function d(e,n,t,r,o){(je(n)?E:Me)(n,function(n,a){var i,s,u=n,l=e[a];if(n&&((s=je(n))||Le(n))){for(var c=r.length;c--;)if(i=r[c]==n){l=o[c];break}if(!i){var f;t&&(u=t(l,n),(f="undefined"!=typeof u)&&(l=u)),f||(l=s?je(l)?l:[]:Le(l)?l:{}),r.push(n),o.push(l),f||d(l,n,t,r,o)}}else t&&(u=t(l,n),"undefined"==typeof u&&(u=n)),"undefined"!=typeof u&&(l=u);e[a]=l})}function g(e,n,t,r,o,a){var s=1&n,l=2&n,c=4&n,f=16&n,d=32&n;if(!l&&!_(e))throw new TypeError;f&&!t.length&&(n&=-17,f=t=!1),d&&!r.length&&(n&=-33,d=r=!1);var y=e&&e.__bindData__;if(y&&y!==!0)return y=i(y),y[2]&&(y[2]=i(y[2])),y[3]&&(y[3]=i(y[3])),!s||1&y[1]||(y[4]=o),!s&&1&y[1]&&(n|=8),!c||4&y[1]||(y[5]=a),f&&pe.apply(y[2]||(y[2]=[]),t),d&&ge.apply(y[3]||(y[3]=[]),r),y[1]|=n,g.apply(null,y);var m=1==n||17===n?u:p;return m([e,n,t,r,o,a])}function y(){K.shadowedProps=I,K.array=K.bottom=K.loop=K.top="",K.init="iterable",K.useHas=!0;for(var e,n=0;e=arguments[n];n++)for(var t in e)K[t]=e[t];var r=K.args;K.firstArg=/^[^,]+/.exec(r)[0];var o=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+r+") {\n"+xe(K)+"\n}");return o(f,W,oe,fe,C,h,je,A,K.keys,ae,Q,we,V,ie,se)}function m(e){return"function"==typeof e&&ue.test(e)}function b(e){var n,t;return!(!(e&&se.call(e)==$&&(n=e.constructor,!_(n)||n instanceof n))||!_e.argsClass&&h(e)||!_e.nodeClass&&o(e))&&(_e.ownLast?(Ce(e,function(e,n,r){return t=fe.call(r,n),!1}),t!==!1):(Ce(e,function(e,n){t=n}),"undefined"==typeof t||fe.call(e,t)))}function h(e){return e&&"object"==typeof e&&"number"==typeof e.length&&se.call(e)==D||!1}function v(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t=n,n=!1),l(e,n,"function"==typeof t&&f(t,r,1))}function w(e){var n=!0;if(!e)return n;var t=se.call(e),r=e.length;return t==R||t==V||(_e.argsClass?t==D:h(e))||t==$&&"number"==typeof r&&_(e.splice)?!r:(Me(e,function(){return n=!1}),n)}function _(e){return"function"==typeof e}function x(e){return!(!e||!Q[typeof e])}function A(e){return"string"==typeof e||e&&"object"==typeof e&&se.call(e)==V||!1}function j(e){var n=arguments,t=2;if(!x(e))return e;if("number"!=typeof n[2]&&(t=n.length),t>3&&"function"==typeof n[t-2])var o=f(n[--t-1],n[t--],2);else t>2&&"function"==typeof n[t-1]&&(o=n[--t]);for(var s=i(arguments,1,t),u=-1,l=r(),c=r();++u<t;)d(e,s[u],o,l,c);return a(l),a(c),e}function E(e,n,t){if(n&&"undefined"==typeof t&&je(e))for(var r=-1,o=e.length;++r<o&&n(e[r],r,e)!==!1;);else Ne(e,n,t);return e}function P(e){for(var n=-1,t=e?e.length:0,r=[];++n<t;){var o=e[n];o&&r.push(o)}return r}function O(e,n){return arguments.length>2?g(e,17,i(arguments,2),null,n):g(e,1,null,null,n)}function T(e){return e}function N(){}var S=[],C={},M=40,L=/\w*$/,B=/^\s*function[ \n\r\t]+\w/,F=/\bthis\b/,I=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],D="[object Arguments]",R="[object Array]",H="[object Boolean]",U="[object Date]",W="[object Error]",G="[object Function]",q="[object Number]",$="[object Object]",X="[object RegExp]",V="[object String]",z={};z[G]=!1,z[D]=z[R]=z[H]=z[U]=z[q]=z[$]=z[X]=z[V]=!0;var J={configurable:!1,enumerable:!1,value:null,writable:!1},K={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Y=Q[typeof window]&&window||this,Z=Q[typeof t]&&t&&!t.nodeType&&t,ee=Q[typeof n]&&n&&!n.nodeType&&n,ne=ee&&ee.exports===Z&&Z,te=Q[typeof e]&&e;!te||te.global!==te&&te.window!==te||(Y=te);var re=[],oe=Error.prototype,ae=Object.prototype,ie=String.prototype,se=ae.toString,ue=RegExp("^"+String(se).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),le=Function.prototype.toString,ce=m(ce=Object.getPrototypeOf)&&ce,fe=ae.hasOwnProperty,pe=re.push,de=ae.propertyIsEnumerable,ge=re.unshift,ye=function(){try{var e={},n=m(n=Object.defineProperty)&&n,t=n(e,e,e)&&n}catch(r){}return t}(),me=m(me=Object.create)&&me,be=m(be=Array.isArray)&&be,he=m(he=Object.keys)&&he,ve={};ve[R]=Array,ve[H]=Boolean,ve[U]=Date,ve[G]=Function,ve[$]=Object,ve[q]=Number,ve[X]=RegExp,ve[V]=String;var we={};we[R]=we[U]=we[q]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},we[H]=we[V]={constructor:!0,toString:!0,valueOf:!0},we[W]=we[G]=we[X]={constructor:!0,toString:!0},we[$]={constructor:!0},function(){for(var e=I.length;e--;){var n=I[e];for(var t in we)fe.call(we,t)&&!fe.call(we[t],n)&&(we[t][n]=!1)}}();var _e=s.support={};!function(){var e=function(){this.x=1},n={0:1,length:1},t=[];e.prototype={valueOf:1,y:1};for(var r in new e)t.push(r);for(r in arguments);_e.argsClass=se.call(arguments)==D,_e.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),_e.enumErrorProps=de.call(oe,"message")||de.call(oe,"name"),_e.enumPrototypes=de.call(e,"prototype"),_e.funcDecomp=!m(Y.WinRTError)&&F.test(function(){return this}),_e.funcNames="string"==typeof Function.name,_e.nonEnumArgs=0!=r,_e.nonEnumShadows=!/valueOf/.test(t),_e.ownLast="x"!=t[0],_e.spliceObjects=(re.splice.call(n,0,1),!n[0]),_e.unindexedChars="x"[0]+Object("x")[0]!="xx";try{_e.nodeClass=!(se.call(document)==$&&!({toString:0}+""))}catch(o){_e.nodeClass=!0}}(1);var xe=function(e){var n="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(n+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",_e.unindexedChars&&(n+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),n+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):_e.nonEnumArgs&&(n+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),_e.enumPrototypes&&(n+="\n  var skipProto = typeof iterable == 'function';\n  "),_e.enumErrorProps&&(n+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var t=[];if(_e.enumPrototypes&&t.push('!(skipProto && index == "prototype")'),_e.enumErrorProps&&t.push('!(skipErrorProps && (index == "message" || index == "name"))'),e.useHas&&e.keys)n+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",t.length&&(n+="    if ("+t.join(" && ")+") {\n  "),n+=e.loop+";    ",t.length&&(n+="\n    }"),n+="\n  }  ";else if(n+="\n  for (index in iterable) {\n",e.useHas&&t.push("hasOwnProperty.call(iterable, index)"),t.length&&(n+="    if ("+t.join(" && ")+") {\n  "),n+=e.loop+";    ",t.length&&(n+="\n    }"),n+="\n  }    ",_e.nonEnumShadows){for(n+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)n+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(n+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),n+=") {\n      "+e.loop+";\n    }      ";n+="\n  }    "}return(e.array||_e.nonEnumArgs)&&(n+="\n}"),n+=e.bottom+";\nreturn result"};me||(c=function(){function e(){}return function(n){if(x(n)){e.prototype=n;var t=new e;e.prototype=null}return t||Y.Object()}}());var Ae=ye?function(e,n){J.value=n,ye(e,"__bindData__",J)}:N;_e.argsClass||(h=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&fe.call(e,"callee")&&!de.call(e,"callee")||!1});var je=be||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&se.call(e)==R||!1},Ee=y({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Pe=he?function(e){return x(e)?_e.enumPrototypes&&"function"==typeof e||_e.nonEnumArgs&&e.length&&h(e)?Ee(e):he(e):[]}:Ee,ke={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Pe,loop:"if (callback(iterable[index], index, collection) === false) return result"},Oe={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Pe,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Te={top:"if (!objectTypes[typeof iterable]) return result;\n"+ke.top,array:!1},Ne=y(ke),Se=y(Oe,{top:Oe.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Ce=y(ke,Te,{useHas:!1}),Me=y(ke,Te);_(/x/)&&(_=function(e){return"function"==typeof e&&se.call(e)==G});var Le=ce?function(e){if(!e||se.call(e)!=$||!_e.argsClass&&h(e))return!1;var n=e.valueOf,t=m(n)&&(t=ce(n))&&ce(t);return t?e==t||ce(e)==t:b(e)}:b;s.assign=Se,s.bind=O,s.compact=P,s.forEach=E,s.forIn=Ce,s.forOwn=Me,s.keys=Pe,s.merge=j,s.each=E,s.extend=Se,s.clone=v,s.identity=T,s.isArguments=h,s.isArray=je,s.isEmpty=w,s.isFunction=_,s.isObject=x,s.isPlainObject=Le,s.isString=A,s.noop=N,s.VERSION="2.4.1",Z&&ee&&ne&&((ee.exports=s)._=s)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n,t){function r(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(o(r,n)),e;case"Feature":return e.geometry=r(e.geometry,n),e;case"Polygon":case"MultiPolygon":return a(e,n);default:return e}}function o(e,n){return function(t){return e(t,n)}}function a(e,n){return"Polygon"===e.type?e.coordinates=i(e.coordinates,n):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(o(i,n))),e}function i(e,n){n=!!n,e[0]=s(e[0],!n);for(var t=1;t<e.length;t++)e[t]=s(e[t],n);return e}function s(e,n){return u(e)===n?e:e.reverse()}function u(e){return l.ring(e)>=0}var l=e("geojson-area");n.exports=r},{"geojson-area":4}],4:[function(e,n,t){function r(e){if("Polygon"===e.type)return o(e.coordinates);if("MultiPolygon"===e.type){for(var n=0,t=0;t<e.coordinates.length;t++)n+=o(e.coordinates[t]);return n}return null}function o(e){var n=0;if(e&&e.length>0){n+=Math.abs(a(e[0]));for(var t=1;t<e.length;t++)n-=Math.abs(a(e[t]))}return n}function a(e){var n=0;if(e.length>2){for(var t,r,o=0;o<e.length-1;o++)t=e[o],r=e[o+1],n+=i(r[0]-t[0])*(2+Math.sin(i(t[1]))+Math.sin(i(r[1])));n=n*s.RADIUS*s.RADIUS/2}return n}function i(e){return e*Math.PI/180}var s=e("wgs84");n.exports.geometry=r,n.exports.ring=a},{wgs84:5}],5:[function(e,n,t){n.exports.RADIUS=6378137,n.exports.FLATTENING=1/298.257223563,n.exports.POLAR_RADIUS=6356752.3142},{}],6:[function(e,n,t){n.exports={building:!0,highway:{included_values:{services:!0,rest_area:!0,escape:!0}},natural:{excluded_values:{coastline:!0,cliff:!0,ridge:!0,arete:!0,tree_row:!0}},landuse:!0,waterway:{included_values:{riverbank:!0,dock:!0,boatyard:!0,dam:!0}},amenity:!0,leisure:!0,barrier:{included_values:{city_wall:!0,ditch:!0,hedge:!0,retaining_wall:!0,wall:!0,spikes:!0}},railway:{included_values:{station:!0,turntable:!0,roundhouse:!0,platform:!0}},area:!0,boundary:!0,man_made:{excluded_values:{cutline:!0,embankment:!0,pipeline:!0}},power:{included_values:{plant:!0,substation:!0,generator:!0,transformer:!0}},place:!0,shop:!0,aeroway:{excluded_values:{taxiway:!0}},tourism:!0,historic:!0,public_transport:!0,office:!0,"building:part":!0,military:!0,ruins:!0,"area:highway":!0,craft:!0,golf:!0}},{}]},{},[1])(1)});var streets=[],geocoder=null,refresh_poi=null;$(document).ready(function(){$.ajaxSetup({cache:!1,type:"GET"}),$("#mapcontrols").css("margin-bottom","5px"),$("#mapcontrols").append('<input class="ui-button ui-state-default ColVis_Button" type="button" name="zoom" value="Zoom to vector" id="zoompoi" title=""/>'),$("#mapcontrols").append('<input class="ui-button ui-state-default ColVis_Button" type="button" name="clearpopups" value="Clear popups" id="clrpopups" title=""/>'),$("#mapcontrols").append('<input class="ui-button ui-state-default ColVis_Button" type="button" name="vrfyjosm" value="Check JOSM" id="vrfyjosm" title=""/>'),$("#mapcontrols").append('<input class="ui-button ui-state-default ColVis_Button" type="button" name="rstfilter" value="Reset filter" id="rstfilter" title=""/>'),$("#clrpopups").click(function(event){for($("#msg").removeClass().addClass("notice info");map.popups.length;)map.removePopup(map.popups[0]);return $("#msg").html("Action: Popups cleared").removeClass().addClass("notice success"),event.preventDefault(),!1}),$("#vrfyjosm").click(function(event){return $("#msg").removeClass().addClass("notice info"),testJosmVersion(),event.preventDefault(),!1}),$("#rstfilter").click(function(event){return $("#msg").removeClass().addClass("notice success").html("Action: Reset all filters"),filterStrategy.setFilter(null),mergeStrategy.setFilter(null),streetStrategy.setFilter(null),buildingStrategy.setFilter(null),event.preventDefault(),!1}),$("#address").focus(function(){$("#address").val("")}),$("#zoompoi").click(function(){$("body").css("cursor","wait");var bounds=vector_layer.getDataExtent();return null!==bounds&&void 0!==bounds&&(map.panTo(bounds.getCenterLonLat()),map.zoomToExtent(bounds,!0)),$("body").css("cursor","default"),!0}),$("#idtagadd").dblclick(function(event){event.preventDefault(),$("body").css("cursor","progress");var lat=$("#idtaglat").val(),lon=$("#idtaglon").val(),address=$("#idtagadd").val(),url="http://nominatim.openstreetmap.org/reverse.php?format=json&lon="+lon+"&lat="+lat+"&zoom=18&addressdetails=1&accept-language=nl,en;q=0.8,fr;q=0.5";null!==lat&&void 0!==lat&&0!=lat&&null!==lon&&void 0!==lon&&0!=lon&&address.length<=0&&(geocode=function(){var geocode=null;$.ajax({async:!0,global:!1,url:url,dataType:"json",success:function(data){geocode=data}});var road="",housenumber="",postcode="",city="";null!==geocode.address.road&&void 0!==geocode.address.road&&(road=geocode.address.road+" "),null!==geocode.address.housenumber&&void 0!==geocode.address.housenumber&&(housenumber=geocode.address.housenumber+", "),null!==geocode.address.postcode&&void 0!==geocode.address.postcode&&(postcode=geocode.address.postcode+" "),null!==geocode.address.city&&void 0!==geocode.address.city&&(city=geocode.address.city);var geoaddress=road+housenumber+postcode+city;return $("#idtagadd").val(geoaddress),$("body").css("cursor","default"),geocode}()),$("body").css("cursor","default")}),$("#idtagadd").keydown(function(event){13==event.which&&$("#idtagadd").dblclick()}),$(function(){var geoCodeURL="proxy/search.php?format=json&accept-language=nl,en;q=0.8,fr;q=0.5";$("#radio").buttonset(),$("#geosearch").append('<input class="ui-button ui-state-default ColVis_Button" type="button" name="clearsearch" value="X" id="clssearch" title="Wissen zoekbox" />'),$("#address").autocomplete({source:function(request,response){var google=$("#sgoogle").attr("checked");null!==google&&void 0!==google?geocoder.geocode({address:request.term},function(results,status){return $("#address").removeClass("ui-autocomplete-loading"),"OK"!=status?("ZERO_RESULTS"==status&&$("#msg").removeClass().addClass("notice info").html("Result: No results found with these search options"),[]):void response($.map(results,function(item){return{label:item.formatted_address,value:item.formatted_address,lat:item.geometry.location.d,lon:item.geometry.location.e}}))}):$.ajax({url:geoCodeURL,data:{format:"json",q:request.term},success:function(data){$("#address").removeClass("ui-autocomplete-loading"),data.length<=0&&$("#msg").removeClass().addClass("notice info").html("Result: No results found with these search options"),response($.map(data,function(item){return{label:item.display_name,value:item.display_name,lat:item.lat,lon:item.lon}}))},statusCode:{404:function(){$("#msg").removeClass().addClass("notice error").html("Error: Problem with external geocoding service")}}})},minLength:4,delay:500,select:function(event,ui){$("#address").removeClass("ui-autocomplete-loading");var style_blue,epsg4326=new OpenLayers.Projection("EPSG:4326"),layer_style=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);if(style_blue=OpenLayers.Util.extend({},layer_style),style_blue.strokeColor="blue",style_blue.fillColor="blue",style_blue.graphicName="star",style_blue.pointRadius=10,style_blue.strokeWidth=3,style_blue.rotation=45,style_blue.strokeLinecap="butt",map.setCenter(new OpenLayers.LonLat(ui.item.lon,ui.item.lat).transform(epsg4326,map.getProjectionObject()),17),null!==ui.item.lat&&void 0!==ui.item.lat&&0!=ui.item.lat&&null!==ui.item.lon&&void 0!==ui.item.lon&&0!=ui.item.lon){var llat=ui.item.lat,llon=ui.item.lon,templabel=ui.item.label,lonlat=new OpenLayers.LonLat(llon,llat);lonlat.transform(epsg4326,map.getProjectionObject());var point=new OpenLayers.Geometry.Point(lonlat.lat,lonlat.lon),pointFeature=new OpenLayers.Feature.Vector(point,null,style_blue);return pointFeature.attributes={name:templabel,lon:llon,lat:llat,align:"cm"},!0}},open:function(){var offset=$("#address").offset(),height=$("#address").height();$(".ui-autocomplete").css("top",offset.top+height),$(".ui-autocomplete").css("left",offset.left),$(".ui-autocomplete").css("z-index",9999),$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}),$("#clssearch").click(function(){return $("#address").removeClass("ui-autocomplete-loading"),$("#address").val(""),!0})}),geocoder=new google.maps.Geocoder});var lon=4.46795,lat=50.97485,zoom=9,map,vector_layer,event_layer,overpass_layer,agiv_layer,osmInfo,filterStrategy,streetStrategy,buildingStrategy,mergeStrategy,parentFilter,newlayername="source-layer",isvecup=null,stuff=null,streetextents=null,overpassapi="http://overpass-api.de/api/interpreter?data=";$(document).ready(function(){function openStreetview(lat,lon){var dataUrl="http://cbk0.google.com/cbk?output=json&ll="+lat+","+lon+"&";$.ajax({url:dataUrl,dataType:"jsonp",data:{}}).done(function(data){if(data&&data.Location&&data.Location.panoId){var url="http://maps.google.com/maps?layer=c&cbp=0,,,,30&panoid="+data.Location.panoId;window.open(url,"_blank")}else $("#msg").html("Warning : Street View could not allocate position.").removeClass().addClass("notice warning")}).fail(function(jqXHR,textStatus,errorThrown){$("#msg").html("Error : Street View - fail(): textStatus: "+textStatus+" / errorThrown: "+errorThrown).removeClass().addClass("notice error")})}$("#msg").html("Action: DocReady"),$(function(){$("#msg").removeClass().addClass("notice info"),$("#msg").html("Action: Init buttons"),$("#opass").button().click(function(event){$("#msg").removeClass().addClass("notice info").html("Action: Loading overpass data"),$("body").css("cursor","wait"),getOsmInfo(),$("body").css("cursor","default")}),$("#fpass").button().click(function(event){$("#msg").removeClass().addClass("notice info").html("Action: Filtering GRB vector layer (overpass data / BBOX)"),$("body").css("cursor","wait"),filterForJosm(),$("body").css("cursor","default")}),$("#popupswitch").button().click(function(event){return $(this).prop("checked")?($("#msg").removeClass().addClass("notice info").html("Config: Popup autoloading enabled."),$("#lbl_popupswitch > span").html("Disable Popups")):($("#msg").removeClass().addClass("notice info").html("Config: Popup autoloading disabled."),$("#lbl_popupswitch > span").html("Enable Popups")),!0}),$("#labelswitch").button().click(function(event){return $(this).prop("checked")?($("#msg").removeClass().addClass("notice info").html("Config: Labels enabled."),$("#lbl_labelswitch > span").html("Labels off")):($("#msg").removeClass().addClass("notice info").html("Config: Labels disabled."),$("#lbl_labelswitch > span").html("Labels On")),!0}),$("#testswitch").button().click(function(event){return openStreetview(lat,lon),!0}),$("#loadgrb").button().click(function(event){return $("#msg").removeClass().addClass("notice info").html("Action: Loading vector GRB data in a new JOSM layer"),$("body").css("cursor","wait"),openInJosm(),$("body").css("cursor","default"),event.preventDefault(),!1}),$("#loadarea").button().click(function(event){return $("#msg").removeClass().addClass("notice info").html("Action: Opening area in JOSM"),$("body").css("cursor","wait"),openAreaInJosm(),$("body").css("cursor","default"),event.preventDefault(),!1})}),$("#msg").html("Action: docReadydone")}),jQuery.fn.encHTML=function(){return this.each(function(){var me=jQuery(this),html=me.html();me.html(html.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))})},jQuery.fn.decHTML=function(){return this.each(function(){var me=jQuery(this),html=me.html();me.html(html.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"))})},jQuery.fn.isEncHTML=function(str){
return str.search(/&amp;/g)!=-1||str.search(/&lt;/g)!=-1||str.search(/&gt;/g)!=-1};
